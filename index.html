<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mở Bao Lì Xì Năm Mới 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .container {
            position: relative;
            z-index: 2;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 60px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease;
        }

        .header h1 {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .header p {
            color: #fff;
            font-size: 14px;
        }

        .fortune-cards-intro {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0 40px 0;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .fortune-cards-intro.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .fortune-card-intro {
            width: 60px;
            height: 120px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255,215,0,0.4);
            border: 2px solid #ffd700;
            animation: cardIntro 1s ease forwards;
            opacity: 0;
            overflow: hidden;
        }

        .fortune-card-intro img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .fortune-card-intro:nth-child(1) { animation-delay: 0s; }
        .fortune-card-intro:nth-child(2) { animation-delay: 0.2s; }
        .fortune-card-intro:nth-child(3) { animation-delay: 0.4s; }

        .fortune-card-intro.hiding {
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        @keyframes cardIntro {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .gifts-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
            perspective: 1000px;
        }

        .gift-wrapper {
            width: 80px;
            height: 110px;
            position: relative;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .gift-wrapper.shuffling {
            animation: none;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .gift-wrapper.shuffle-left {
            transform: translateX(-95px) scale(0.95) rotateZ(-5deg);
        }

        .gift-wrapper.shuffle-right {
            transform: translateX(95px) scale(0.95) rotateZ(5deg);
        }

        .gift-wrapper.shuffle-center {
            transform: translateX(0) scale(1.05) rotateZ(0deg);
            z-index: 10;
        }

        .gift-wrapper.selected {
            transform: scale(2.5) translateY(-60px);
            z-index: 100;
        }

        .gift-box-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gift-wrapper:not(.selected) .gift-box-3d:hover {
            transform: translateY(-5px);
        }

        .gift-wrapper.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .envelope-svg {
            width: 100%;
            height: 100%;
            position: absolute;
            bottom: 0;
            z-index: 2;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
        }

        .envelope-flap {
            width: 100%;
            height: 45%;
            position: absolute;
            top: 0;
            transform-origin: bottom;
            transition: transform 0.8s ease;
            z-index: 10;
            overflow: hidden;
        }

        .envelope-flap svg {
            width: 100%;
            height: 222%;
            position: absolute;
            bottom: 0;
        }

        .gift-wrapper.opening .envelope-flap {
            transform: rotateX(-120deg);
        }

        .fortune-card-inside {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        .fortune-card-flying {
            position: fixed;
            width: 60px;
            height: 90px;
            border-radius: 5px;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(255,215,0,0.6);
            border: 2px solid #ffd700;
            overflow: hidden;
        }

        .fortune-card-flying img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .money-reveal {
            position: fixed;
            width: 200px;
            height: 420px;
            border-radius: 8px;
            transform: translate(-50%, -50%) scale(0);
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(255,215,0,0.8);
            border: 3px solid #ffd700;
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
            background: white;
        }

        .money-reveal img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .money-reveal.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .light-burst {
            position: fixed;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            pointer-events: none;
            z-index: 99;
            transition: all 0.6s ease;
        }

        .light-burst.active {
            transform: translate(-50%, -50%) scale(3);
            opacity: 0;
        }

        .instruction {
            text-align: center;
            color: #ffd700;
            font-size: 16px;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            min-height: 24px;
        }

        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .result-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .result-content {
            background: linear-gradient(135deg, #330066, #1a0033);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            border: 3px solid #ffd700;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        .result-content h2 {
            color: #ffd700;
            font-size: 28px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .result-money-display {
            width: 180px;
            height: 380px;
            margin: 20px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(255,215,0,0.5);
            border: 2px solid #ffd700;
        }

        .result-money-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-again-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #330066;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255,215,0,0.4);
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .play-again-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255,215,0,0.6);
        }

        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1500;
        }

        @keyframes explode {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <div class="container">
        <div class="header">
            <h1>MỪNG XUÂN BÍNH NGỌ</h1>
            <p>Chọn một bao lì xì đi emmm!</p>
        </div>

        <div class="fortune-cards-intro" id="fortuneCardsIntro">
            <div class="fortune-card-intro">
                <img src="images/tien1.png" alt="Tờ tiền 1">
            </div>
            <div class="fortune-card-intro">
                <img src="images/tien2.png" alt="Tờ tiền 2">
            </div>
            <div class="fortune-card-intro">
                <img src="images/tien3.png" alt="Tờ tiền 3">
            </div>
        </div>

        <div class="instruction" id="instruction">Chờ tí nhé...</div>

        <div class="gifts-container" id="giftsContainer">
            <div class="gift-wrapper">
                <div class="gift-box-3d">
                    <div class="envelope-svg">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="30" width="90" height="105" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <circle cx="50" cy="75" r="20" fill="none" stroke="#ffd700" stroke-width="2" opacity="0.6"/>
                            <text x="50" y="82" font-size="24" fill="#ffd700" text-anchor="middle" font-weight="bold">福</text>
                            <rect x="8" y="33" width="84" height="99" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="envelope-flap">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="0" width="90" height="63" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <rect x="8" y="3" width="84" height="57" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="fortune-card-inside"></div>
                </div>
            </div>
            <div class="gift-wrapper">
                <div class="gift-box-3d">
                    <div class="envelope-svg">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="30" width="90" height="105" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <circle cx="50" cy="75" r="20" fill="none" stroke="#ffd700" stroke-width="2" opacity="0.6"/>
                            <text x="50" y="82" font-size="24" fill="#ffd700" text-anchor="middle" font-weight="bold">福</text>
                            <rect x="8" y="33" width="84" height="99" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="envelope-flap">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="0" width="90" height="63" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <rect x="8" y="3" width="84" height="57" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="fortune-card-inside"></div>
                </div>
            </div>
            <div class="gift-wrapper">
                <div class="gift-box-3d">
                    <div class="envelope-svg">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="30" width="90" height="105" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <circle cx="50" cy="75" r="20" fill="none" stroke="#ffd700" stroke-width="2" opacity="0.6"/>
                            <text x="50" y="82" font-size="24" fill="#ffd700" text-anchor="middle" font-weight="bold">福</text>
                            <rect x="8" y="33" width="84" height="99" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="envelope-flap">
                        <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                            <rect x="5" y="0" width="90" height="63" rx="3" fill="#dc143c" stroke="#b8860b" stroke-width="2"/>
                            <rect x="8" y="3" width="84" height="57" rx="2" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.4"/>
                        </svg>
                    </div>
                    <div class="fortune-card-inside"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="result-overlay" id="resultOverlay">
        <div class="result-content">
            <div class="result-money-display" id="resultMoneyDisplay"></div>   
        </div>
    </div>

    <script>
        const fortunes = [
            { title: 'Tờ 500.000đ', image: 'images/tien1.png' },
            { title: 'Tờ 200.000đ', image: 'images/tien2.png' },
            { title: 'Tờ 100.000đ', image: 'images/tien3.png' }
        ];

        const random = Math.random() * 100;
        const WINNING_FORTUNE = random < 70 ? 2 : random < 90 ? 1 : 0;
        let gameStarted = false;
        let boxClicked = false;
        let winningBoxIndex = -1;

        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        function createFirework(x, y) {
            const colors = ['#ff6b6b', '#ffd700', '#4ecdc4', '#45b7d1', '#f7b731'];
            const particles = 30;
            
            for (let i = 0; i < particles; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (Math.PI * 2 * i) / particles;
                const velocity = 50 + Math.random() * 50;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                particle.style.setProperty('--x', tx + 'px');
                particle.style.setProperty('--y', ty + 'px');
                particle.style.animation = 'explode 1s ease-out forwards';
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        function animateCardToBox(cardIndex, boxElement) {
            const fortuneCard = document.querySelectorAll('.fortune-card-intro')[cardIndex];
            const cardRect = fortuneCard.getBoundingClientRect();
            const boxRect = boxElement.getBoundingClientRect();
            
            fortuneCard.classList.add('hiding');
            
            const flyingCard = document.createElement('div');
            flyingCard.className = 'fortune-card-flying';
            
            const img = document.createElement('img');
            img.src = fortunes[cardIndex].image;
            img.alt = fortunes[cardIndex].title;
            flyingCard.appendChild(img);
            
            flyingCard.style.left = cardRect.left + 'px';
            flyingCard.style.top = cardRect.top + 'px';
            document.body.appendChild(flyingCard);

            setTimeout(() => {
                flyingCard.style.transition = 'all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.2s ease-in 0.6s';
                flyingCard.style.left = (boxRect.left + boxRect.width / 2 - 30) + 'px';
                flyingCard.style.top = (boxRect.top + boxRect.height / 2 - 45) + 'px';
                flyingCard.style.transform = 'scale(0.2)';
                flyingCard.style.opacity = '0';
            }, 50);

            setTimeout(() => {
                flyingCard.remove();
                const insideCard = boxElement.querySelector('.fortune-card-inside');
                insideCard.textContent = fortunes[cardIndex].title;
                insideCard.setAttribute('data-image', fortunes[cardIndex].image);
            }, 900);
        }

        async function fillBoxes() {
            const boxes = document.querySelectorAll('.gift-wrapper');
            boxes.forEach(box => box.classList.add('opening'));
            await sleep(1000);

            for (let i = 0; i < 3; i++) {
                animateCardToBox(i, boxes[i]);
                await sleep(400);
            }

            await sleep(1000);
            document.getElementById('fortuneCardsIntro').classList.add('hidden');
            await sleep(500);

            boxes.forEach(box => box.classList.remove('opening'));
            await sleep(1000);

            await shuffleBoxes();
            gameStarted = true;
            document.getElementById('instruction').textContent = 'Chọn một bao lì xì đi em!';
        }

        async function shuffleBoxes() {
            const container = document.getElementById('giftsContainer');
            const boxes = Array.from(document.querySelectorAll('.gift-wrapper'));
            document.getElementById('instruction').textContent = 'Đang xáo trộn...';

            const shufflePatterns = [[2, 0, 1], [1, 2, 0], [0, 2, 1], [2, 1, 0], [1, 0, 2]];

            for (let round = 0; round < shufflePatterns.length; round++) {
                const pattern = shufflePatterns[round];
                boxes.forEach(box => box.classList.add('shuffling'));

                boxes.forEach((box, index) => {
                    box.classList.remove('shuffle-left', 'shuffle-center', 'shuffle-right');
                    const targetPos = pattern.indexOf(index);
                    if (targetPos === 0) box.classList.add('shuffle-left');
                    else if (targetPos === 1) box.classList.add('shuffle-center');
                    else box.classList.add('shuffle-right');
                });

                await sleep(500);
                const newOrder = pattern.map(i => boxes[i]);
                newOrder.forEach(box => container.appendChild(box));
                boxes.forEach(box => box.classList.remove('shuffle-left', 'shuffle-center', 'shuffle-right'));
                await sleep(200);
                boxes.forEach(box => box.classList.remove('shuffling'));
                await sleep(300);
            }

            const finalBoxes = Array.from(document.querySelectorAll('.gift-wrapper'));
            finalBoxes.forEach((box, index) => {
                const insideCard = box.querySelector('.fortune-card-inside');
                if (insideCard.textContent === fortunes[WINNING_FORTUNE].title) {
                    winningBoxIndex = index;
                }
            });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function createLightBurst(x, y) {
            const lightBurst = document.createElement('div');
            lightBurst.className = 'light-burst';
            lightBurst.style.left = x + 'px';
            lightBurst.style.top = y + 'px';
            document.body.appendChild(lightBurst);
            setTimeout(() => lightBurst.classList.add('active'), 10);
            setTimeout(() => lightBurst.remove(), 1000);
        }

        function revealMoney(boxElement, fortuneImage) {
            const boxRect = boxElement.getBoundingClientRect();
            const centerX = boxRect.left + boxRect.width / 2;
            const centerY = boxRect.top + boxRect.height / 2;

            const revealMoney = document.createElement('div');
            revealMoney.className = 'money-reveal';
            
            const img = document.createElement('img');
            img.src = fortuneImage;
            revealMoney.appendChild(img);
            
            revealMoney.style.left = centerX + 'px';
            revealMoney.style.top = centerY + 'px';
            document.body.appendChild(revealMoney);

            setTimeout(() => revealMoney.classList.add('active'), 10);
            return revealMoney;
        }

        document.querySelectorAll('.gift-wrapper').forEach((box, index) => {
            box.addEventListener('click', async function() {
                if (!gameStarted || boxClicked) return;
                boxClicked = true;
                
                document.querySelectorAll('.gift-wrapper').forEach((b, i) => {
                    if (i !== index) b.classList.add('disabled');
                });

                this.classList.add('selected');
                await sleep(800);

                const boxRect = this.getBoundingClientRect();
                createLightBurst(boxRect.left + boxRect.width / 2, boxRect.top + boxRect.height / 2);

                this.classList.add('opening');
                await sleep(600);

                const insideCard = this.querySelector('.fortune-card-inside');
                const fortuneImage = insideCard.getAttribute('data-image');
                const revealMoneyElement = revealMoney(this, fortuneImage);

                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createFirework(
                            Math.random() * window.innerWidth,
                            Math.random() * window.innerHeight / 2
                        );
                    }, i * 150);
                }

                await sleep(2000);
                revealMoneyElement.remove();

                const resultDisplay = document.getElementById('resultMoneyDisplay');
                resultDisplay.innerHTML = `<img src="${fortuneImage}" alt="Tờ tiền">`;
                document.getElementById('resultOverlay').classList.add('active');
            });
        });

        function resetGame() {
            location.reload();
        }

        createStars();
        setTimeout(() => fillBoxes(), 2000);

        setInterval(() => {
            if (Math.random() > 0.7) {
                createFirework(
                    Math.random() * window.innerWidth,
                    Math.random() * window.innerHeight / 2
                );
            }
        }, 2000);
    </script>
</body>
</html>